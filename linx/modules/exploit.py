import socket
import pymysql
import redis

class Exploit(object):
    '''漏洞利用模块'''
    name = 'exploit module'
    desc = 'exploit vulnerabilities'
    version = '1.0.0'

    def __init__(self, host: str, port: int) -> None:
        self.host = host
        self.port = port

    def redis_rce(self, command: str) -> str:
        '''Redis远程命令执行漏洞利用'''
        try:
            r = redis.Redis(host=self.host, port=self.port)
            result = r.execute_command(command)
            return str(result, 'utf-8') if isinstance(result, bytes) else str(result)
        except Exception as e:
            return f"执行失败: {str(e)}"

    def mysql_rce(self, user: str, password: str, command: str) -> str:
        '''MySQL远程命令执行漏洞利用'''
        try:
            conn = pymysql.connect(
                host=self.host,
                port=self.port,
                user=user,
                password=password
            )
            cursor = conn.cursor()
            cursor.execute(command)
            result = cursor.fetchall()
            cursor.close()
            conn.close()
            return str(result)
        except Exception as e:
            return f"执行失败: {str(e)}"